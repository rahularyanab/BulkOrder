{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":89,"index":89}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":90},"end":{"line":2,"column":69,"index":159}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":160},"end":{"line":3,"column":38,"index":198}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":199},"end":{"line":4,"column":40,"index":239}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/AuthContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.AuthProvider = AuthProvider;\n  exports.useAuth = useAuth;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _servicesApi = require(_dependencyMap[2], \"../services/api\");\n  var _expoRouter = require(_dependencyMap[3], \"expo-router\");\n  var _reactJsxDevRuntime = require(_dependencyMap[4], \"react/jsx-dev-runtime\");\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function AuthProvider({\n    children\n  }) {\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const [token, setToken] = (0, _react.useState)(null);\n    const [phone, setPhone] = (0, _react.useState)(null);\n    const [retailer, setRetailerState] = (0, _react.useState)(null);\n    const router = (0, _expoRouter.useRouter)();\n    (0, _react.useEffect)(() => {\n      loadStoredAuth();\n    }, []);\n    const loadStoredAuth = async () => {\n      try {\n        const storedToken = await AsyncStorage.default.getItem('auth_token');\n        const storedPhone = await AsyncStorage.default.getItem('auth_phone');\n        if (storedToken && storedPhone) {\n          setToken(storedToken);\n          setPhone(storedPhone);\n          _servicesApi.api.setToken(storedToken);\n\n          // Try to fetch retailer details\n          try {\n            const retailerData = await _servicesApi.api.getCurrentRetailer();\n            setRetailerState(retailerData);\n          } catch (error) {\n            // Retailer not found - might be new user\n            console.log('Retailer not found, might need signup');\n          }\n        }\n      } catch (error) {\n        console.error('Error loading auth:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    const login = async (newToken, isNewUser, retailerId) => {\n      try {\n        // Decode phone from token (simple approach)\n        const payload = JSON.parse(atob(newToken.split('.')[1]));\n        const userPhone = payload.sub;\n        await AsyncStorage.default.setItem('auth_token', newToken);\n        await AsyncStorage.default.setItem('auth_phone', userPhone);\n        setToken(newToken);\n        setPhone(userPhone);\n        _servicesApi.api.setToken(newToken);\n        if (!isNewUser && retailerId) {\n          const retailerData = await _servicesApi.api.getCurrentRetailer();\n          setRetailerState(retailerData);\n        }\n      } catch (error) {\n        console.error('Error during login:', error);\n        throw error;\n      }\n    };\n    const logout = async () => {\n      await AsyncStorage.default.removeItem('auth_token');\n      await AsyncStorage.default.removeItem('auth_phone');\n      setToken(null);\n      setPhone(null);\n      setRetailerState(null);\n      _servicesApi.api.setToken(null);\n      router.replace('/(auth)/phone');\n    };\n    const setRetailer = retailerData => {\n      setRetailerState(retailerData);\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: {\n        isAuthenticated: !!token,\n        isLoading,\n        token,\n        phone,\n        retailer,\n        login,\n        logout,\n        setRetailer\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 5\n    }, this);\n  }\n  function useAuth() {\n    const context = (0, _react.useContext)(AuthContext);\n    if (context === undefined) {\n      throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n  }\n});","lineCount":113,"map":[[13,2,37,0,"exports"],[13,9,37,0],[13,10,37,0,"AuthProvider"],[13,22,37,0],[13,25,37,0,"AuthProvider"],[13,37,37,0],[14,2,129,0,"exports"],[14,9,129,0],[14,10,129,0,"useAuth"],[14,17,129,0],[14,20,129,0,"useAuth"],[14,27,129,0],[15,2,1,0],[15,6,1,0,"_react"],[15,12,1,0],[15,15,1,0,"require"],[15,22,1,0],[15,23,1,0,"_dependencyMap"],[15,37,1,0],[16,2,2,0],[16,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[16,42,2,0],[16,45,2,0,"require"],[16,52,2,0],[16,53,2,0,"_dependencyMap"],[16,67,2,0],[17,2,2,0],[17,6,2,0,"AsyncStorage"],[17,18,2,0],[17,21,2,0,"_interopDefault"],[17,36,2,0],[17,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[17,73,2,0],[18,2,3,0],[18,6,3,0,"_servicesApi"],[18,18,3,0],[18,21,3,0,"require"],[18,28,3,0],[18,29,3,0,"_dependencyMap"],[18,43,3,0],[19,2,4,0],[19,6,4,0,"_expoRouter"],[19,17,4,0],[19,20,4,0,"require"],[19,27,4,0],[19,28,4,0,"_dependencyMap"],[19,42,4,0],[20,2,4,40],[20,6,4,40,"_reactJsxDevRuntime"],[20,25,4,40],[20,28,4,40,"require"],[20,35,4,40],[20,36,4,40,"_dependencyMap"],[20,50,4,40],[21,2,35,0],[21,8,35,6,"AuthContext"],[21,19,35,17],[21,35,35,20],[21,39,35,20,"createContext"],[21,45,35,33],[21,46,35,33,"createContext"],[21,59,35,33],[21,61,35,63,"undefined"],[21,70,35,72],[21,71,35,73],[22,2,37,7],[22,11,37,16,"AuthProvider"],[22,23,37,28,"AuthProvider"],[22,24,37,29],[23,4,37,31,"children"],[24,2,37,65],[24,3,37,66],[24,5,37,68],[25,4,38,2],[25,10,38,8],[25,11,38,9,"isLoading"],[25,20,38,18],[25,22,38,20,"setIsLoading"],[25,34,38,32],[25,35,38,33],[25,38,38,36],[25,42,38,36,"useState"],[25,48,38,44],[25,49,38,44,"useState"],[25,57,38,44],[25,59,38,45],[25,63,38,49],[25,64,38,50],[26,4,39,2],[26,10,39,8],[26,11,39,9,"token"],[26,16,39,14],[26,18,39,16,"setToken"],[26,26,39,24],[26,27,39,25],[26,30,39,28],[26,34,39,28,"useState"],[26,40,39,36],[26,41,39,36,"useState"],[26,49,39,36],[26,51,39,52],[26,55,39,56],[26,56,39,57],[27,4,40,2],[27,10,40,8],[27,11,40,9,"phone"],[27,16,40,14],[27,18,40,16,"setPhone"],[27,26,40,24],[27,27,40,25],[27,30,40,28],[27,34,40,28,"useState"],[27,40,40,36],[27,41,40,36,"useState"],[27,49,40,36],[27,51,40,52],[27,55,40,56],[27,56,40,57],[28,4,41,2],[28,10,41,8],[28,11,41,9,"retailer"],[28,19,41,17],[28,21,41,19,"setRetailerState"],[28,37,41,35],[28,38,41,36],[28,41,41,39],[28,45,41,39,"useState"],[28,51,41,47],[28,52,41,47,"useState"],[28,60,41,47],[28,62,41,65],[28,66,41,69],[28,67,41,70],[29,4,42,2],[29,10,42,8,"router"],[29,16,42,14],[29,19,42,17],[29,23,42,17,"useRouter"],[29,34,42,26],[29,35,42,26,"useRouter"],[29,44,42,26],[29,46,42,27],[29,47,42,28],[30,4,44,2],[30,8,44,2,"useEffect"],[30,14,44,11],[30,15,44,11,"useEffect"],[30,24,44,11],[30,26,44,12],[30,32,44,18],[31,6,45,4,"loadStoredAuth"],[31,20,45,18],[31,21,45,19],[31,22,45,20],[32,4,46,2],[32,5,46,3],[32,7,46,5],[32,9,46,7],[32,10,46,8],[33,4,48,2],[33,10,48,8,"loadStoredAuth"],[33,24,48,22],[33,27,48,25],[33,33,48,25,"loadStoredAuth"],[33,34,48,25],[33,39,48,37],[34,6,49,4],[34,10,49,8],[35,8,50,6],[35,14,50,12,"storedToken"],[35,25,50,23],[35,28,50,26],[35,34,50,32,"AsyncStorage"],[35,46,50,44],[35,47,50,44,"default"],[35,54,50,44],[35,55,50,45,"getItem"],[35,62,50,52],[35,63,50,53],[35,75,50,65],[35,76,50,66],[36,8,51,6],[36,14,51,12,"storedPhone"],[36,25,51,23],[36,28,51,26],[36,34,51,32,"AsyncStorage"],[36,46,51,44],[36,47,51,44,"default"],[36,54,51,44],[36,55,51,45,"getItem"],[36,62,51,52],[36,63,51,53],[36,75,51,65],[36,76,51,66],[37,8,53,6],[37,12,53,10,"storedToken"],[37,23,53,21],[37,27,53,25,"storedPhone"],[37,38,53,36],[37,40,53,38],[38,10,54,8,"setToken"],[38,18,54,16],[38,19,54,17,"storedToken"],[38,30,54,28],[38,31,54,29],[39,10,55,8,"setPhone"],[39,18,55,16],[39,19,55,17,"storedPhone"],[39,30,55,28],[39,31,55,29],[40,10,56,8,"api"],[40,22,56,11],[40,23,56,11,"api"],[40,26,56,11],[40,27,56,12,"setToken"],[40,35,56,20],[40,36,56,21,"storedToken"],[40,47,56,32],[40,48,56,33],[42,10,58,8],[43,10,59,8],[43,14,59,12],[44,12,60,10],[44,18,60,16,"retailerData"],[44,30,60,28],[44,33,60,31],[44,39,60,37,"api"],[44,51,60,40],[44,52,60,40,"api"],[44,55,60,40],[44,56,60,41,"getCurrentRetailer"],[44,74,60,59],[44,75,60,60],[44,76,60,61],[45,12,61,10,"setRetailerState"],[45,28,61,26],[45,29,61,27,"retailerData"],[45,41,61,39],[45,42,61,40],[46,10,62,8],[46,11,62,9],[46,12,62,10],[46,19,62,17,"error"],[46,24,62,22],[46,26,62,24],[47,12,63,10],[48,12,64,10,"console"],[48,19,64,17],[48,20,64,18,"log"],[48,23,64,21],[48,24,64,22],[48,63,64,61],[48,64,64,62],[49,10,65,8],[50,8,66,6],[51,6,67,4],[51,7,67,5],[51,8,67,6],[51,15,67,13,"error"],[51,20,67,18],[51,22,67,20],[52,8,68,6,"console"],[52,15,68,13],[52,16,68,14,"error"],[52,21,68,19],[52,22,68,20],[52,43,68,41],[52,45,68,43,"error"],[52,50,68,48],[52,51,68,49],[53,6,69,4],[53,7,69,5],[53,16,69,14],[54,8,70,6,"setIsLoading"],[54,20,70,18],[54,21,70,19],[54,26,70,24],[54,27,70,25],[55,6,71,4],[56,4,72,2],[56,5,72,3],[57,4,74,2],[57,10,74,8,"login"],[57,15,74,13],[57,18,74,16],[57,24,74,16,"login"],[57,25,74,23,"newToken"],[57,33,74,39],[57,35,74,41,"isNewUser"],[57,44,74,59],[57,46,74,61,"retailerId"],[57,56,74,86],[57,61,74,91],[58,6,75,4],[58,10,75,8],[59,8,76,6],[60,8,77,6],[60,14,77,12,"payload"],[60,21,77,19],[60,24,77,22,"JSON"],[60,28,77,26],[60,29,77,27,"parse"],[60,34,77,32],[60,35,77,33,"atob"],[60,39,77,37],[60,40,77,38,"newToken"],[60,48,77,46],[60,49,77,47,"split"],[60,54,77,52],[60,55,77,53],[60,58,77,56],[60,59,77,57],[60,60,77,58],[60,61,77,59],[60,62,77,60],[60,63,77,61],[60,64,77,62],[61,8,78,6],[61,14,78,12,"userPhone"],[61,23,78,21],[61,26,78,24,"payload"],[61,33,78,31],[61,34,78,32,"sub"],[61,37,78,35],[62,8,80,6],[62,14,80,12,"AsyncStorage"],[62,26,80,24],[62,27,80,24,"default"],[62,34,80,24],[62,35,80,25,"setItem"],[62,42,80,32],[62,43,80,33],[62,55,80,45],[62,57,80,47,"newToken"],[62,65,80,55],[62,66,80,56],[63,8,81,6],[63,14,81,12,"AsyncStorage"],[63,26,81,24],[63,27,81,24,"default"],[63,34,81,24],[63,35,81,25,"setItem"],[63,42,81,32],[63,43,81,33],[63,55,81,45],[63,57,81,47,"userPhone"],[63,66,81,56],[63,67,81,57],[64,8,83,6,"setToken"],[64,16,83,14],[64,17,83,15,"newToken"],[64,25,83,23],[64,26,83,24],[65,8,84,6,"setPhone"],[65,16,84,14],[65,17,84,15,"userPhone"],[65,26,84,24],[65,27,84,25],[66,8,85,6,"api"],[66,20,85,9],[66,21,85,9,"api"],[66,24,85,9],[66,25,85,10,"setToken"],[66,33,85,18],[66,34,85,19,"newToken"],[66,42,85,27],[66,43,85,28],[67,8,87,6],[67,12,87,10],[67,13,87,11,"isNewUser"],[67,22,87,20],[67,26,87,24,"retailerId"],[67,36,87,34],[67,38,87,36],[68,10,88,8],[68,16,88,14,"retailerData"],[68,28,88,26],[68,31,88,29],[68,37,88,35,"api"],[68,49,88,38],[68,50,88,38,"api"],[68,53,88,38],[68,54,88,39,"getCurrentRetailer"],[68,72,88,57],[68,73,88,58],[68,74,88,59],[69,10,89,8,"setRetailerState"],[69,26,89,24],[69,27,89,25,"retailerData"],[69,39,89,37],[69,40,89,38],[70,8,90,6],[71,6,91,4],[71,7,91,5],[71,8,91,6],[71,15,91,13,"error"],[71,20,91,18],[71,22,91,20],[72,8,92,6,"console"],[72,15,92,13],[72,16,92,14,"error"],[72,21,92,19],[72,22,92,20],[72,43,92,41],[72,45,92,43,"error"],[72,50,92,48],[72,51,92,49],[73,8,93,6],[73,14,93,12,"error"],[73,19,93,17],[74,6,94,4],[75,4,95,2],[75,5,95,3],[76,4,97,2],[76,10,97,8,"logout"],[76,16,97,14],[76,19,97,17],[76,25,97,17,"logout"],[76,26,97,17],[76,31,97,29],[77,6,98,4],[77,12,98,10,"AsyncStorage"],[77,24,98,22],[77,25,98,22,"default"],[77,32,98,22],[77,33,98,23,"removeItem"],[77,43,98,33],[77,44,98,34],[77,56,98,46],[77,57,98,47],[78,6,99,4],[78,12,99,10,"AsyncStorage"],[78,24,99,22],[78,25,99,22,"default"],[78,32,99,22],[78,33,99,23,"removeItem"],[78,43,99,33],[78,44,99,34],[78,56,99,46],[78,57,99,47],[79,6,100,4,"setToken"],[79,14,100,12],[79,15,100,13],[79,19,100,17],[79,20,100,18],[80,6,101,4,"setPhone"],[80,14,101,12],[80,15,101,13],[80,19,101,17],[80,20,101,18],[81,6,102,4,"setRetailerState"],[81,22,102,20],[81,23,102,21],[81,27,102,25],[81,28,102,26],[82,6,103,4,"api"],[82,18,103,7],[82,19,103,7,"api"],[82,22,103,7],[82,23,103,8,"setToken"],[82,31,103,16],[82,32,103,17],[82,36,103,21],[82,37,103,22],[83,6,104,4,"router"],[83,12,104,10],[83,13,104,11,"replace"],[83,20,104,18],[83,21,104,19],[83,36,104,34],[83,37,104,35],[84,4,105,2],[84,5,105,3],[85,4,107,2],[85,10,107,8,"setRetailer"],[85,21,107,19],[85,24,107,23,"retailerData"],[85,36,107,45],[85,40,107,50],[86,6,108,4,"setRetailerState"],[86,22,108,20],[86,23,108,21,"retailerData"],[86,35,108,33],[86,36,108,34],[87,4,109,2],[87,5,109,3],[88,4,111,2],[88,24,112,4],[88,28,112,4,"_reactJsxDevRuntime"],[88,47,112,4],[88,48,112,4,"jsxDEV"],[88,54,112,4],[88,56,112,5,"AuthContext"],[88,67,112,16],[88,68,112,17,"Provider"],[88,76,112,25],[89,6,113,6,"value"],[89,11,113,11],[89,13,113,13],[90,8,114,8,"isAuthenticated"],[90,23,114,23],[90,25,114,25],[90,26,114,26],[90,27,114,27,"token"],[90,32,114,32],[91,8,115,8,"isLoading"],[91,17,115,17],[92,8,116,8,"token"],[92,13,116,13],[93,8,117,8,"phone"],[93,13,117,13],[94,8,118,8,"retailer"],[94,16,118,16],[95,8,119,8,"login"],[95,13,119,13],[96,8,120,8,"logout"],[96,14,120,14],[97,8,121,8,"setRetailer"],[98,6,122,6],[98,7,122,8],[99,6,122,8,"children"],[99,14,122,8],[99,16,124,7,"children"],[100,4,124,15],[101,6,124,15,"fileName"],[101,14,124,15],[101,16,124,15,"_jsxFileName"],[101,28,124,15],[102,6,124,15,"lineNumber"],[102,16,124,15],[103,6,124,15,"columnNumber"],[103,18,124,15],[104,4,124,15],[104,11,125,26],[104,12,125,27],[105,2,127,0],[106,2,129,7],[106,11,129,16,"useAuth"],[106,18,129,23,"useAuth"],[106,19,129,23],[106,21,129,26],[107,4,130,2],[107,10,130,8,"context"],[107,17,130,15],[107,20,130,18],[107,24,130,18,"useContext"],[107,30,130,28],[107,31,130,28,"useContext"],[107,41,130,28],[107,43,130,29,"AuthContext"],[107,54,130,40],[107,55,130,41],[108,4,131,2],[108,8,131,6,"context"],[108,15,131,13],[108,20,131,18,"undefined"],[108,29,131,27],[108,31,131,29],[109,6,132,4],[109,12,132,10],[109,16,132,14,"Error"],[109,21,132,19],[109,22,132,20],[109,67,132,65],[109,68,132,66],[110,4,133,2],[111,4,134,2],[111,11,134,9,"context"],[111,18,134,16],[112,2,135,0],[113,0,135,1],[113,3]],"functionMap":{"names":["<global>","AuthProvider","useEffect$argument_0","loadStoredAuth","login","logout","setRetailer","useAuth"],"mappings":"AAA;OCoC;YCO;GDE;yBEE;GFwB;gBGE;GHqB;iBIE;GJQ;sBKE;GLE;CDkB;OOE;CPM"},"hasCjsExports":false},"type":"js/module"}]}