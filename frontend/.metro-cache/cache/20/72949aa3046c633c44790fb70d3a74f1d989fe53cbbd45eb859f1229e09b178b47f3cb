{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":89,"index":89}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":90},"end":{"line":2,"column":69,"index":159}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":160},"end":{"line":3,"column":38,"index":198}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":199},"end":{"line":4,"column":40,"index":239}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/AuthContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.AuthProvider = AuthProvider;\n  exports.useAuth = useAuth;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _servicesApi = require(_dependencyMap[2], \"../services/api\");\n  var _expoRouter = require(_dependencyMap[3], \"expo-router\");\n  var _reactJsxDevRuntime = require(_dependencyMap[4], \"react/jsx-dev-runtime\");\n  // Admin phone numbers\n  const ADMIN_PHONES = ['9999999999', '8888888888', '1234567890'];\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function AuthProvider({\n    children\n  }) {\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const [token, setToken] = (0, _react.useState)(null);\n    const [phone, setPhone] = (0, _react.useState)(null);\n    const [retailer, setRetailerState] = (0, _react.useState)(null);\n    const router = (0, _expoRouter.useRouter)();\n    const isAdmin = phone ? ADMIN_PHONES.includes(phone) : false;\n    (0, _react.useEffect)(() => {\n      loadStoredAuth();\n    }, []);\n    const loadStoredAuth = async () => {\n      try {\n        const storedToken = await AsyncStorage.default.getItem('auth_token');\n        const storedPhone = await AsyncStorage.default.getItem('auth_phone');\n        if (storedToken && storedPhone) {\n          setToken(storedToken);\n          setPhone(storedPhone);\n          _servicesApi.api.setToken(storedToken);\n\n          // Check if admin - admins don't need retailer profile\n          if (ADMIN_PHONES.includes(storedPhone)) {\n            console.log('Admin user detected, skipping retailer fetch');\n          } else {\n            // Try to fetch retailer details for non-admin users\n            try {\n              const retailerData = await _servicesApi.api.getCurrentRetailer();\n              setRetailerState(retailerData);\n            } catch (error) {\n              // Retailer not found - might be new user or token expired\n              console.log('Retailer not found, might need signup');\n              // Clear invalid token for non-admin users without retailer\n              // This forces them to login again\n            }\n          }\n        }\n      } catch (error) {\n        console.error('Error loading auth:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    const login = async (newToken, isNewUser, retailerId) => {\n      try {\n        // Decode phone from token (simple approach)\n        const payload = JSON.parse(atob(newToken.split('.')[1]));\n        const userPhone = payload.sub;\n        await AsyncStorage.default.setItem('auth_token', newToken);\n        await AsyncStorage.default.setItem('auth_phone', userPhone);\n        setToken(newToken);\n        setPhone(userPhone);\n        _servicesApi.api.setToken(newToken);\n        if (!isNewUser && retailerId) {\n          const retailerData = await _servicesApi.api.getCurrentRetailer();\n          setRetailerState(retailerData);\n        }\n      } catch (error) {\n        console.error('Error during login:', error);\n        throw error;\n      }\n    };\n    const logout = async () => {\n      await AsyncStorage.default.removeItem('auth_token');\n      await AsyncStorage.default.removeItem('auth_phone');\n      setToken(null);\n      setPhone(null);\n      setRetailerState(null);\n      _servicesApi.api.setToken(null);\n      router.replace('/(auth)/phone');\n    };\n    const setRetailer = retailerData => {\n      setRetailerState(retailerData);\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: {\n        isAuthenticated: !!token,\n        isLoading,\n        isAdmin,\n        token,\n        phone,\n        retailer,\n        login,\n        logout,\n        setRetailer\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 5\n    }, this);\n  }\n  function useAuth() {\n    const context = (0, _react.useContext)(AuthContext);\n    if (context === undefined) {\n      throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n  }\n});","lineCount":124,"map":[[13,2,41,0,"exports"],[13,9,41,0],[13,10,41,0,"AuthProvider"],[13,22,41,0],[13,25,41,0,"AuthProvider"],[13,37,41,0],[14,2,143,0,"exports"],[14,9,143,0],[14,10,143,0,"useAuth"],[14,17,143,0],[14,20,143,0,"useAuth"],[14,27,143,0],[15,2,1,0],[15,6,1,0,"_react"],[15,12,1,0],[15,15,1,0,"require"],[15,22,1,0],[15,23,1,0,"_dependencyMap"],[15,37,1,0],[16,2,2,0],[16,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[16,42,2,0],[16,45,2,0,"require"],[16,52,2,0],[16,53,2,0,"_dependencyMap"],[16,67,2,0],[17,2,2,0],[17,6,2,0,"AsyncStorage"],[17,18,2,0],[17,21,2,0,"_interopDefault"],[17,36,2,0],[17,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[17,73,2,0],[18,2,3,0],[18,6,3,0,"_servicesApi"],[18,18,3,0],[18,21,3,0,"require"],[18,28,3,0],[18,29,3,0,"_dependencyMap"],[18,43,3,0],[19,2,4,0],[19,6,4,0,"_expoRouter"],[19,17,4,0],[19,20,4,0,"require"],[19,27,4,0],[19,28,4,0,"_dependencyMap"],[19,42,4,0],[20,2,4,40],[20,6,4,40,"_reactJsxDevRuntime"],[20,25,4,40],[20,28,4,40,"require"],[20,35,4,40],[20,36,4,40,"_dependencyMap"],[20,50,4,40],[21,2,36,0],[22,2,37,0],[22,8,37,6,"ADMIN_PHONES"],[22,20,37,18],[22,23,37,21],[22,24,37,22],[22,36,37,34],[22,38,37,36],[22,50,37,48],[22,52,37,50],[22,64,37,62],[22,65,37,63],[23,2,39,0],[23,8,39,6,"AuthContext"],[23,19,39,17],[23,35,39,20],[23,39,39,20,"createContext"],[23,45,39,33],[23,46,39,33,"createContext"],[23,59,39,33],[23,61,39,63,"undefined"],[23,70,39,72],[23,71,39,73],[24,2,41,7],[24,11,41,16,"AuthProvider"],[24,23,41,28,"AuthProvider"],[24,24,41,29],[25,4,41,31,"children"],[26,2,41,65],[26,3,41,66],[26,5,41,68],[27,4,42,2],[27,10,42,8],[27,11,42,9,"isLoading"],[27,20,42,18],[27,22,42,20,"setIsLoading"],[27,34,42,32],[27,35,42,33],[27,38,42,36],[27,42,42,36,"useState"],[27,48,42,44],[27,49,42,44,"useState"],[27,57,42,44],[27,59,42,45],[27,63,42,49],[27,64,42,50],[28,4,43,2],[28,10,43,8],[28,11,43,9,"token"],[28,16,43,14],[28,18,43,16,"setToken"],[28,26,43,24],[28,27,43,25],[28,30,43,28],[28,34,43,28,"useState"],[28,40,43,36],[28,41,43,36,"useState"],[28,49,43,36],[28,51,43,52],[28,55,43,56],[28,56,43,57],[29,4,44,2],[29,10,44,8],[29,11,44,9,"phone"],[29,16,44,14],[29,18,44,16,"setPhone"],[29,26,44,24],[29,27,44,25],[29,30,44,28],[29,34,44,28,"useState"],[29,40,44,36],[29,41,44,36,"useState"],[29,49,44,36],[29,51,44,52],[29,55,44,56],[29,56,44,57],[30,4,45,2],[30,10,45,8],[30,11,45,9,"retailer"],[30,19,45,17],[30,21,45,19,"setRetailerState"],[30,37,45,35],[30,38,45,36],[30,41,45,39],[30,45,45,39,"useState"],[30,51,45,47],[30,52,45,47,"useState"],[30,60,45,47],[30,62,45,65],[30,66,45,69],[30,67,45,70],[31,4,46,2],[31,10,46,8,"router"],[31,16,46,14],[31,19,46,17],[31,23,46,17,"useRouter"],[31,34,46,26],[31,35,46,26,"useRouter"],[31,44,46,26],[31,46,46,27],[31,47,46,28],[32,4,48,2],[32,10,48,8,"isAdmin"],[32,17,48,15],[32,20,48,18,"phone"],[32,25,48,23],[32,28,48,26,"ADMIN_PHONES"],[32,40,48,38],[32,41,48,39,"includes"],[32,49,48,47],[32,50,48,48,"phone"],[32,55,48,53],[32,56,48,54],[32,59,48,57],[32,64,48,62],[33,4,50,2],[33,8,50,2,"useEffect"],[33,14,50,11],[33,15,50,11,"useEffect"],[33,24,50,11],[33,26,50,12],[33,32,50,18],[34,6,51,4,"loadStoredAuth"],[34,20,51,18],[34,21,51,19],[34,22,51,20],[35,4,52,2],[35,5,52,3],[35,7,52,5],[35,9,52,7],[35,10,52,8],[36,4,54,2],[36,10,54,8,"loadStoredAuth"],[36,24,54,22],[36,27,54,25],[36,33,54,25,"loadStoredAuth"],[36,34,54,25],[36,39,54,37],[37,6,55,4],[37,10,55,8],[38,8,56,6],[38,14,56,12,"storedToken"],[38,25,56,23],[38,28,56,26],[38,34,56,32,"AsyncStorage"],[38,46,56,44],[38,47,56,44,"default"],[38,54,56,44],[38,55,56,45,"getItem"],[38,62,56,52],[38,63,56,53],[38,75,56,65],[38,76,56,66],[39,8,57,6],[39,14,57,12,"storedPhone"],[39,25,57,23],[39,28,57,26],[39,34,57,32,"AsyncStorage"],[39,46,57,44],[39,47,57,44,"default"],[39,54,57,44],[39,55,57,45,"getItem"],[39,62,57,52],[39,63,57,53],[39,75,57,65],[39,76,57,66],[40,8,59,6],[40,12,59,10,"storedToken"],[40,23,59,21],[40,27,59,25,"storedPhone"],[40,38,59,36],[40,40,59,38],[41,10,60,8,"setToken"],[41,18,60,16],[41,19,60,17,"storedToken"],[41,30,60,28],[41,31,60,29],[42,10,61,8,"setPhone"],[42,18,61,16],[42,19,61,17,"storedPhone"],[42,30,61,28],[42,31,61,29],[43,10,62,8,"api"],[43,22,62,11],[43,23,62,11,"api"],[43,26,62,11],[43,27,62,12,"setToken"],[43,35,62,20],[43,36,62,21,"storedToken"],[43,47,62,32],[43,48,62,33],[45,10,64,8],[46,10,65,8],[46,14,65,12,"ADMIN_PHONES"],[46,26,65,24],[46,27,65,25,"includes"],[46,35,65,33],[46,36,65,34,"storedPhone"],[46,47,65,45],[46,48,65,46],[46,50,65,48],[47,12,66,10,"console"],[47,19,66,17],[47,20,66,18,"log"],[47,23,66,21],[47,24,66,22],[47,70,66,68],[47,71,66,69],[48,10,67,8],[48,11,67,9],[48,17,67,15],[49,12,68,10],[50,12,69,10],[50,16,69,14],[51,14,70,12],[51,20,70,18,"retailerData"],[51,32,70,30],[51,35,70,33],[51,41,70,39,"api"],[51,53,70,42],[51,54,70,42,"api"],[51,57,70,42],[51,58,70,43,"getCurrentRetailer"],[51,76,70,61],[51,77,70,62],[51,78,70,63],[52,14,71,12,"setRetailerState"],[52,30,71,28],[52,31,71,29,"retailerData"],[52,43,71,41],[52,44,71,42],[53,12,72,10],[53,13,72,11],[53,14,72,12],[53,21,72,19,"error"],[53,26,72,24],[53,28,72,26],[54,14,73,12],[55,14,74,12,"console"],[55,21,74,19],[55,22,74,20,"log"],[55,25,74,23],[55,26,74,24],[55,65,74,63],[55,66,74,64],[56,14,75,12],[57,14,76,12],[58,12,77,10],[59,10,78,8],[60,8,79,6],[61,6,80,4],[61,7,80,5],[61,8,80,6],[61,15,80,13,"error"],[61,20,80,18],[61,22,80,20],[62,8,81,6,"console"],[62,15,81,13],[62,16,81,14,"error"],[62,21,81,19],[62,22,81,20],[62,43,81,41],[62,45,81,43,"error"],[62,50,81,48],[62,51,81,49],[63,6,82,4],[63,7,82,5],[63,16,82,14],[64,8,83,6,"setIsLoading"],[64,20,83,18],[64,21,83,19],[64,26,83,24],[64,27,83,25],[65,6,84,4],[66,4,85,2],[66,5,85,3],[67,4,87,2],[67,10,87,8,"login"],[67,15,87,13],[67,18,87,16],[67,24,87,16,"login"],[67,25,87,23,"newToken"],[67,33,87,39],[67,35,87,41,"isNewUser"],[67,44,87,59],[67,46,87,61,"retailerId"],[67,56,87,86],[67,61,87,91],[68,6,88,4],[68,10,88,8],[69,8,89,6],[70,8,90,6],[70,14,90,12,"payload"],[70,21,90,19],[70,24,90,22,"JSON"],[70,28,90,26],[70,29,90,27,"parse"],[70,34,90,32],[70,35,90,33,"atob"],[70,39,90,37],[70,40,90,38,"newToken"],[70,48,90,46],[70,49,90,47,"split"],[70,54,90,52],[70,55,90,53],[70,58,90,56],[70,59,90,57],[70,60,90,58],[70,61,90,59],[70,62,90,60],[70,63,90,61],[70,64,90,62],[71,8,91,6],[71,14,91,12,"userPhone"],[71,23,91,21],[71,26,91,24,"payload"],[71,33,91,31],[71,34,91,32,"sub"],[71,37,91,35],[72,8,93,6],[72,14,93,12,"AsyncStorage"],[72,26,93,24],[72,27,93,24,"default"],[72,34,93,24],[72,35,93,25,"setItem"],[72,42,93,32],[72,43,93,33],[72,55,93,45],[72,57,93,47,"newToken"],[72,65,93,55],[72,66,93,56],[73,8,94,6],[73,14,94,12,"AsyncStorage"],[73,26,94,24],[73,27,94,24,"default"],[73,34,94,24],[73,35,94,25,"setItem"],[73,42,94,32],[73,43,94,33],[73,55,94,45],[73,57,94,47,"userPhone"],[73,66,94,56],[73,67,94,57],[74,8,96,6,"setToken"],[74,16,96,14],[74,17,96,15,"newToken"],[74,25,96,23],[74,26,96,24],[75,8,97,6,"setPhone"],[75,16,97,14],[75,17,97,15,"userPhone"],[75,26,97,24],[75,27,97,25],[76,8,98,6,"api"],[76,20,98,9],[76,21,98,9,"api"],[76,24,98,9],[76,25,98,10,"setToken"],[76,33,98,18],[76,34,98,19,"newToken"],[76,42,98,27],[76,43,98,28],[77,8,100,6],[77,12,100,10],[77,13,100,11,"isNewUser"],[77,22,100,20],[77,26,100,24,"retailerId"],[77,36,100,34],[77,38,100,36],[78,10,101,8],[78,16,101,14,"retailerData"],[78,28,101,26],[78,31,101,29],[78,37,101,35,"api"],[78,49,101,38],[78,50,101,38,"api"],[78,53,101,38],[78,54,101,39,"getCurrentRetailer"],[78,72,101,57],[78,73,101,58],[78,74,101,59],[79,10,102,8,"setRetailerState"],[79,26,102,24],[79,27,102,25,"retailerData"],[79,39,102,37],[79,40,102,38],[80,8,103,6],[81,6,104,4],[81,7,104,5],[81,8,104,6],[81,15,104,13,"error"],[81,20,104,18],[81,22,104,20],[82,8,105,6,"console"],[82,15,105,13],[82,16,105,14,"error"],[82,21,105,19],[82,22,105,20],[82,43,105,41],[82,45,105,43,"error"],[82,50,105,48],[82,51,105,49],[83,8,106,6],[83,14,106,12,"error"],[83,19,106,17],[84,6,107,4],[85,4,108,2],[85,5,108,3],[86,4,110,2],[86,10,110,8,"logout"],[86,16,110,14],[86,19,110,17],[86,25,110,17,"logout"],[86,26,110,17],[86,31,110,29],[87,6,111,4],[87,12,111,10,"AsyncStorage"],[87,24,111,22],[87,25,111,22,"default"],[87,32,111,22],[87,33,111,23,"removeItem"],[87,43,111,33],[87,44,111,34],[87,56,111,46],[87,57,111,47],[88,6,112,4],[88,12,112,10,"AsyncStorage"],[88,24,112,22],[88,25,112,22,"default"],[88,32,112,22],[88,33,112,23,"removeItem"],[88,43,112,33],[88,44,112,34],[88,56,112,46],[88,57,112,47],[89,6,113,4,"setToken"],[89,14,113,12],[89,15,113,13],[89,19,113,17],[89,20,113,18],[90,6,114,4,"setPhone"],[90,14,114,12],[90,15,114,13],[90,19,114,17],[90,20,114,18],[91,6,115,4,"setRetailerState"],[91,22,115,20],[91,23,115,21],[91,27,115,25],[91,28,115,26],[92,6,116,4,"api"],[92,18,116,7],[92,19,116,7,"api"],[92,22,116,7],[92,23,116,8,"setToken"],[92,31,116,16],[92,32,116,17],[92,36,116,21],[92,37,116,22],[93,6,117,4,"router"],[93,12,117,10],[93,13,117,11,"replace"],[93,20,117,18],[93,21,117,19],[93,36,117,34],[93,37,117,35],[94,4,118,2],[94,5,118,3],[95,4,120,2],[95,10,120,8,"setRetailer"],[95,21,120,19],[95,24,120,23,"retailerData"],[95,36,120,45],[95,40,120,50],[96,6,121,4,"setRetailerState"],[96,22,121,20],[96,23,121,21,"retailerData"],[96,35,121,33],[96,36,121,34],[97,4,122,2],[97,5,122,3],[98,4,124,2],[98,24,125,4],[98,28,125,4,"_reactJsxDevRuntime"],[98,47,125,4],[98,48,125,4,"jsxDEV"],[98,54,125,4],[98,56,125,5,"AuthContext"],[98,67,125,16],[98,68,125,17,"Provider"],[98,76,125,25],[99,6,126,6,"value"],[99,11,126,11],[99,13,126,13],[100,8,127,8,"isAuthenticated"],[100,23,127,23],[100,25,127,25],[100,26,127,26],[100,27,127,27,"token"],[100,32,127,32],[101,8,128,8,"isLoading"],[101,17,128,17],[102,8,129,8,"isAdmin"],[102,15,129,15],[103,8,130,8,"token"],[103,13,130,13],[104,8,131,8,"phone"],[104,13,131,13],[105,8,132,8,"retailer"],[105,16,132,16],[106,8,133,8,"login"],[106,13,133,13],[107,8,134,8,"logout"],[107,14,134,14],[108,8,135,8,"setRetailer"],[109,6,136,6],[109,7,136,8],[110,6,136,8,"children"],[110,14,136,8],[110,16,138,7,"children"],[111,4,138,15],[112,6,138,15,"fileName"],[112,14,138,15],[112,16,138,15,"_jsxFileName"],[112,28,138,15],[113,6,138,15,"lineNumber"],[113,16,138,15],[114,6,138,15,"columnNumber"],[114,18,138,15],[115,4,138,15],[115,11,139,26],[115,12,139,27],[116,2,141,0],[117,2,143,7],[117,11,143,16,"useAuth"],[117,18,143,23,"useAuth"],[117,19,143,23],[117,21,143,26],[118,4,144,2],[118,10,144,8,"context"],[118,17,144,15],[118,20,144,18],[118,24,144,18,"useContext"],[118,30,144,28],[118,31,144,28,"useContext"],[118,41,144,28],[118,43,144,29,"AuthContext"],[118,54,144,40],[118,55,144,41],[119,4,145,2],[119,8,145,6,"context"],[119,15,145,13],[119,20,145,18,"undefined"],[119,29,145,27],[119,31,145,29],[120,6,146,4],[120,12,146,10],[120,16,146,14,"Error"],[120,21,146,19],[120,22,146,20],[120,67,146,65],[120,68,146,66],[121,4,147,2],[122,4,148,2],[122,11,148,9,"context"],[122,18,148,16],[123,2,149,0],[124,0,149,1],[124,3]],"functionMap":{"names":["<global>","AuthProvider","useEffect$argument_0","loadStoredAuth","login","logout","setRetailer","useAuth"],"mappings":"AAA;OCwC;YCS;GDE;yBEE;GF+B;gBGE;GHqB;iBIE;GJQ;sBKE;GLE;CDmB;OOE;CPM"},"hasCjsExports":false},"type":"js/module"}]}