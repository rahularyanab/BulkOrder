{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":89,"index":89}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":90},"end":{"line":2,"column":69,"index":159}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":160},"end":{"line":3,"column":38,"index":198}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":199},"end":{"line":4,"column":40,"index":239}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/AuthContext.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.AuthProvider = AuthProvider;\n  exports.useAuth = useAuth;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _servicesApi = require(_dependencyMap[2], \"../services/api\");\n  var _expoRouter = require(_dependencyMap[3], \"expo-router\");\n  var _reactJsxDevRuntime = require(_dependencyMap[4], \"react/jsx-dev-runtime\");\n  // Admin phone numbers\n  const ADMIN_PHONES = ['9999999999', '8888888888', '1234567890'];\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function AuthProvider({\n    children\n  }) {\n    _s();\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const [token, setToken] = (0, _react.useState)(null);\n    const [phone, setPhone] = (0, _react.useState)(null);\n    const [retailer, setRetailerState] = (0, _react.useState)(null);\n    const router = (0, _expoRouter.useRouter)();\n    const isAdmin = phone ? ADMIN_PHONES.includes(phone) : false;\n    (0, _react.useEffect)(() => {\n      loadStoredAuth();\n    }, []);\n    const loadStoredAuth = async () => {\n      try {\n        const storedToken = await AsyncStorage.default.getItem('auth_token');\n        const storedPhone = await AsyncStorage.default.getItem('auth_phone');\n        if (storedToken && storedPhone) {\n          setToken(storedToken);\n          setPhone(storedPhone);\n          _servicesApi.api.setToken(storedToken);\n\n          // Check if admin - admins don't need retailer profile\n          if (ADMIN_PHONES.includes(storedPhone)) {\n            console.log('Admin user detected, skipping retailer fetch');\n          } else {\n            // Try to fetch retailer details for non-admin users\n            try {\n              const retailerData = await _servicesApi.api.getCurrentRetailer();\n              setRetailerState(retailerData);\n            } catch (error) {\n              // Retailer not found - might be new user or token expired\n              console.log('Retailer not found, might need signup');\n              // Clear invalid token for non-admin users without retailer\n              // This forces them to login again\n            }\n          }\n        }\n      } catch (error) {\n        console.error('Error loading auth:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    const login = async (newToken, isNewUser, retailerId) => {\n      try {\n        // Decode phone from token (simple approach)\n        const payload = JSON.parse(atob(newToken.split('.')[1]));\n        const userPhone = payload.sub;\n        await AsyncStorage.default.setItem('auth_token', newToken);\n        await AsyncStorage.default.setItem('auth_phone', userPhone);\n        setToken(newToken);\n        setPhone(userPhone);\n        _servicesApi.api.setToken(newToken);\n        if (!isNewUser && retailerId) {\n          const retailerData = await _servicesApi.api.getCurrentRetailer();\n          setRetailerState(retailerData);\n        }\n      } catch (error) {\n        console.error('Error during login:', error);\n        throw error;\n      }\n    };\n    const logout = async () => {\n      await AsyncStorage.default.removeItem('auth_token');\n      await AsyncStorage.default.removeItem('auth_phone');\n      setToken(null);\n      setPhone(null);\n      setRetailerState(null);\n      _servicesApi.api.setToken(null);\n      router.replace('/(auth)/phone');\n    };\n    const setRetailer = retailerData => {\n      setRetailerState(retailerData);\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: {\n        isAuthenticated: !!token,\n        isLoading,\n        isAdmin,\n        token,\n        phone,\n        retailer,\n        login,\n        logout,\n        setRetailer\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 5\n    }, this);\n  }\n  _s(AuthProvider, \"P2kHx9Gd64ei0q8Vw6wvNLSA4Ro=\", false, function () {\n    return [_expoRouter.useRouter];\n  });\n  _c = AuthProvider;\n  function useAuth() {\n    _s2();\n    const context = (0, _react.useContext)(AuthContext);\n    if (context === undefined) {\n      throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n  }\n  _s2(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n  var _c;\n  $RefreshReg$(_c, \"AuthProvider\");\n});","lineCount":135,"map":[[15,2,41,0,"exports"],[15,9,41,0],[15,10,41,0,"AuthProvider"],[15,22,41,0],[15,25,41,0,"AuthProvider"],[15,37,41,0],[16,2,143,0,"exports"],[16,9,143,0],[16,10,143,0,"useAuth"],[16,17,143,0],[16,20,143,0,"useAuth"],[16,27,143,0],[17,2,1,0],[17,6,1,0,"_react"],[17,12,1,0],[17,15,1,0,"require"],[17,22,1,0],[17,23,1,0,"_dependencyMap"],[17,37,1,0],[18,2,2,0],[18,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[18,42,2,0],[18,45,2,0,"require"],[18,52,2,0],[18,53,2,0,"_dependencyMap"],[18,67,2,0],[19,2,2,0],[19,6,2,0,"AsyncStorage"],[19,18,2,0],[19,21,2,0,"_interopDefault"],[19,36,2,0],[19,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[19,73,2,0],[20,2,3,0],[20,6,3,0,"_servicesApi"],[20,18,3,0],[20,21,3,0,"require"],[20,28,3,0],[20,29,3,0,"_dependencyMap"],[20,43,3,0],[21,2,4,0],[21,6,4,0,"_expoRouter"],[21,17,4,0],[21,20,4,0,"require"],[21,27,4,0],[21,28,4,0,"_dependencyMap"],[21,42,4,0],[22,2,4,40],[22,6,4,40,"_reactJsxDevRuntime"],[22,25,4,40],[22,28,4,40,"require"],[22,35,4,40],[22,36,4,40,"_dependencyMap"],[22,50,4,40],[23,2,36,0],[24,2,37,0],[24,8,37,6,"ADMIN_PHONES"],[24,20,37,18],[24,23,37,21],[24,24,37,22],[24,36,37,34],[24,38,37,36],[24,50,37,48],[24,52,37,50],[24,64,37,62],[24,65,37,63],[25,2,39,0],[25,8,39,6,"AuthContext"],[25,19,39,17],[25,35,39,20],[25,39,39,20,"createContext"],[25,45,39,33],[25,46,39,33,"createContext"],[25,59,39,33],[25,61,39,63,"undefined"],[25,70,39,72],[25,71,39,73],[26,2,41,7],[26,11,41,16,"AuthProvider"],[26,23,41,28,"AuthProvider"],[26,24,41,29],[27,4,41,31,"children"],[28,2,41,65],[28,3,41,66],[28,5,41,68],[29,4,41,68,"_s"],[29,6,41,68],[30,4,42,2],[30,10,42,8],[30,11,42,9,"isLoading"],[30,20,42,18],[30,22,42,20,"setIsLoading"],[30,34,42,32],[30,35,42,33],[30,38,42,36],[30,42,42,36,"useState"],[30,48,42,44],[30,49,42,44,"useState"],[30,57,42,44],[30,59,42,45],[30,63,42,49],[30,64,42,50],[31,4,43,2],[31,10,43,8],[31,11,43,9,"token"],[31,16,43,14],[31,18,43,16,"setToken"],[31,26,43,24],[31,27,43,25],[31,30,43,28],[31,34,43,28,"useState"],[31,40,43,36],[31,41,43,36,"useState"],[31,49,43,36],[31,51,43,52],[31,55,43,56],[31,56,43,57],[32,4,44,2],[32,10,44,8],[32,11,44,9,"phone"],[32,16,44,14],[32,18,44,16,"setPhone"],[32,26,44,24],[32,27,44,25],[32,30,44,28],[32,34,44,28,"useState"],[32,40,44,36],[32,41,44,36,"useState"],[32,49,44,36],[32,51,44,52],[32,55,44,56],[32,56,44,57],[33,4,45,2],[33,10,45,8],[33,11,45,9,"retailer"],[33,19,45,17],[33,21,45,19,"setRetailerState"],[33,37,45,35],[33,38,45,36],[33,41,45,39],[33,45,45,39,"useState"],[33,51,45,47],[33,52,45,47,"useState"],[33,60,45,47],[33,62,45,65],[33,66,45,69],[33,67,45,70],[34,4,46,2],[34,10,46,8,"router"],[34,16,46,14],[34,19,46,17],[34,23,46,17,"useRouter"],[34,34,46,26],[34,35,46,26,"useRouter"],[34,44,46,26],[34,46,46,27],[34,47,46,28],[35,4,48,2],[35,10,48,8,"isAdmin"],[35,17,48,15],[35,20,48,18,"phone"],[35,25,48,23],[35,28,48,26,"ADMIN_PHONES"],[35,40,48,38],[35,41,48,39,"includes"],[35,49,48,47],[35,50,48,48,"phone"],[35,55,48,53],[35,56,48,54],[35,59,48,57],[35,64,48,62],[36,4,50,2],[36,8,50,2,"useEffect"],[36,14,50,11],[36,15,50,11,"useEffect"],[36,24,50,11],[36,26,50,12],[36,32,50,18],[37,6,51,4,"loadStoredAuth"],[37,20,51,18],[37,21,51,19],[37,22,51,20],[38,4,52,2],[38,5,52,3],[38,7,52,5],[38,9,52,7],[38,10,52,8],[39,4,54,2],[39,10,54,8,"loadStoredAuth"],[39,24,54,22],[39,27,54,25],[39,33,54,25,"loadStoredAuth"],[39,34,54,25],[39,39,54,37],[40,6,55,4],[40,10,55,8],[41,8,56,6],[41,14,56,12,"storedToken"],[41,25,56,23],[41,28,56,26],[41,34,56,32,"AsyncStorage"],[41,46,56,44],[41,47,56,44,"default"],[41,54,56,44],[41,55,56,45,"getItem"],[41,62,56,52],[41,63,56,53],[41,75,56,65],[41,76,56,66],[42,8,57,6],[42,14,57,12,"storedPhone"],[42,25,57,23],[42,28,57,26],[42,34,57,32,"AsyncStorage"],[42,46,57,44],[42,47,57,44,"default"],[42,54,57,44],[42,55,57,45,"getItem"],[42,62,57,52],[42,63,57,53],[42,75,57,65],[42,76,57,66],[43,8,59,6],[43,12,59,10,"storedToken"],[43,23,59,21],[43,27,59,25,"storedPhone"],[43,38,59,36],[43,40,59,38],[44,10,60,8,"setToken"],[44,18,60,16],[44,19,60,17,"storedToken"],[44,30,60,28],[44,31,60,29],[45,10,61,8,"setPhone"],[45,18,61,16],[45,19,61,17,"storedPhone"],[45,30,61,28],[45,31,61,29],[46,10,62,8,"api"],[46,22,62,11],[46,23,62,11,"api"],[46,26,62,11],[46,27,62,12,"setToken"],[46,35,62,20],[46,36,62,21,"storedToken"],[46,47,62,32],[46,48,62,33],[48,10,64,8],[49,10,65,8],[49,14,65,12,"ADMIN_PHONES"],[49,26,65,24],[49,27,65,25,"includes"],[49,35,65,33],[49,36,65,34,"storedPhone"],[49,47,65,45],[49,48,65,46],[49,50,65,48],[50,12,66,10,"console"],[50,19,66,17],[50,20,66,18,"log"],[50,23,66,21],[50,24,66,22],[50,70,66,68],[50,71,66,69],[51,10,67,8],[51,11,67,9],[51,17,67,15],[52,12,68,10],[53,12,69,10],[53,16,69,14],[54,14,70,12],[54,20,70,18,"retailerData"],[54,32,70,30],[54,35,70,33],[54,41,70,39,"api"],[54,53,70,42],[54,54,70,42,"api"],[54,57,70,42],[54,58,70,43,"getCurrentRetailer"],[54,76,70,61],[54,77,70,62],[54,78,70,63],[55,14,71,12,"setRetailerState"],[55,30,71,28],[55,31,71,29,"retailerData"],[55,43,71,41],[55,44,71,42],[56,12,72,10],[56,13,72,11],[56,14,72,12],[56,21,72,19,"error"],[56,26,72,24],[56,28,72,26],[57,14,73,12],[58,14,74,12,"console"],[58,21,74,19],[58,22,74,20,"log"],[58,25,74,23],[58,26,74,24],[58,65,74,63],[58,66,74,64],[59,14,75,12],[60,14,76,12],[61,12,77,10],[62,10,78,8],[63,8,79,6],[64,6,80,4],[64,7,80,5],[64,8,80,6],[64,15,80,13,"error"],[64,20,80,18],[64,22,80,20],[65,8,81,6,"console"],[65,15,81,13],[65,16,81,14,"error"],[65,21,81,19],[65,22,81,20],[65,43,81,41],[65,45,81,43,"error"],[65,50,81,48],[65,51,81,49],[66,6,82,4],[66,7,82,5],[66,16,82,14],[67,8,83,6,"setIsLoading"],[67,20,83,18],[67,21,83,19],[67,26,83,24],[67,27,83,25],[68,6,84,4],[69,4,85,2],[69,5,85,3],[70,4,87,2],[70,10,87,8,"login"],[70,15,87,13],[70,18,87,16],[70,24,87,16,"login"],[70,25,87,23,"newToken"],[70,33,87,39],[70,35,87,41,"isNewUser"],[70,44,87,59],[70,46,87,61,"retailerId"],[70,56,87,86],[70,61,87,91],[71,6,88,4],[71,10,88,8],[72,8,89,6],[73,8,90,6],[73,14,90,12,"payload"],[73,21,90,19],[73,24,90,22,"JSON"],[73,28,90,26],[73,29,90,27,"parse"],[73,34,90,32],[73,35,90,33,"atob"],[73,39,90,37],[73,40,90,38,"newToken"],[73,48,90,46],[73,49,90,47,"split"],[73,54,90,52],[73,55,90,53],[73,58,90,56],[73,59,90,57],[73,60,90,58],[73,61,90,59],[73,62,90,60],[73,63,90,61],[73,64,90,62],[74,8,91,6],[74,14,91,12,"userPhone"],[74,23,91,21],[74,26,91,24,"payload"],[74,33,91,31],[74,34,91,32,"sub"],[74,37,91,35],[75,8,93,6],[75,14,93,12,"AsyncStorage"],[75,26,93,24],[75,27,93,24,"default"],[75,34,93,24],[75,35,93,25,"setItem"],[75,42,93,32],[75,43,93,33],[75,55,93,45],[75,57,93,47,"newToken"],[75,65,93,55],[75,66,93,56],[76,8,94,6],[76,14,94,12,"AsyncStorage"],[76,26,94,24],[76,27,94,24,"default"],[76,34,94,24],[76,35,94,25,"setItem"],[76,42,94,32],[76,43,94,33],[76,55,94,45],[76,57,94,47,"userPhone"],[76,66,94,56],[76,67,94,57],[77,8,96,6,"setToken"],[77,16,96,14],[77,17,96,15,"newToken"],[77,25,96,23],[77,26,96,24],[78,8,97,6,"setPhone"],[78,16,97,14],[78,17,97,15,"userPhone"],[78,26,97,24],[78,27,97,25],[79,8,98,6,"api"],[79,20,98,9],[79,21,98,9,"api"],[79,24,98,9],[79,25,98,10,"setToken"],[79,33,98,18],[79,34,98,19,"newToken"],[79,42,98,27],[79,43,98,28],[80,8,100,6],[80,12,100,10],[80,13,100,11,"isNewUser"],[80,22,100,20],[80,26,100,24,"retailerId"],[80,36,100,34],[80,38,100,36],[81,10,101,8],[81,16,101,14,"retailerData"],[81,28,101,26],[81,31,101,29],[81,37,101,35,"api"],[81,49,101,38],[81,50,101,38,"api"],[81,53,101,38],[81,54,101,39,"getCurrentRetailer"],[81,72,101,57],[81,73,101,58],[81,74,101,59],[82,10,102,8,"setRetailerState"],[82,26,102,24],[82,27,102,25,"retailerData"],[82,39,102,37],[82,40,102,38],[83,8,103,6],[84,6,104,4],[84,7,104,5],[84,8,104,6],[84,15,104,13,"error"],[84,20,104,18],[84,22,104,20],[85,8,105,6,"console"],[85,15,105,13],[85,16,105,14,"error"],[85,21,105,19],[85,22,105,20],[85,43,105,41],[85,45,105,43,"error"],[85,50,105,48],[85,51,105,49],[86,8,106,6],[86,14,106,12,"error"],[86,19,106,17],[87,6,107,4],[88,4,108,2],[88,5,108,3],[89,4,110,2],[89,10,110,8,"logout"],[89,16,110,14],[89,19,110,17],[89,25,110,17,"logout"],[89,26,110,17],[89,31,110,29],[90,6,111,4],[90,12,111,10,"AsyncStorage"],[90,24,111,22],[90,25,111,22,"default"],[90,32,111,22],[90,33,111,23,"removeItem"],[90,43,111,33],[90,44,111,34],[90,56,111,46],[90,57,111,47],[91,6,112,4],[91,12,112,10,"AsyncStorage"],[91,24,112,22],[91,25,112,22,"default"],[91,32,112,22],[91,33,112,23,"removeItem"],[91,43,112,33],[91,44,112,34],[91,56,112,46],[91,57,112,47],[92,6,113,4,"setToken"],[92,14,113,12],[92,15,113,13],[92,19,113,17],[92,20,113,18],[93,6,114,4,"setPhone"],[93,14,114,12],[93,15,114,13],[93,19,114,17],[93,20,114,18],[94,6,115,4,"setRetailerState"],[94,22,115,20],[94,23,115,21],[94,27,115,25],[94,28,115,26],[95,6,116,4,"api"],[95,18,116,7],[95,19,116,7,"api"],[95,22,116,7],[95,23,116,8,"setToken"],[95,31,116,16],[95,32,116,17],[95,36,116,21],[95,37,116,22],[96,6,117,4,"router"],[96,12,117,10],[96,13,117,11,"replace"],[96,20,117,18],[96,21,117,19],[96,36,117,34],[96,37,117,35],[97,4,118,2],[97,5,118,3],[98,4,120,2],[98,10,120,8,"setRetailer"],[98,21,120,19],[98,24,120,23,"retailerData"],[98,36,120,45],[98,40,120,50],[99,6,121,4,"setRetailerState"],[99,22,121,20],[99,23,121,21,"retailerData"],[99,35,121,33],[99,36,121,34],[100,4,122,2],[100,5,122,3],[101,4,124,2],[101,24,125,4],[101,28,125,4,"_reactJsxDevRuntime"],[101,47,125,4],[101,48,125,4,"jsxDEV"],[101,54,125,4],[101,56,125,5,"AuthContext"],[101,67,125,16],[101,68,125,17,"Provider"],[101,76,125,25],[102,6,126,6,"value"],[102,11,126,11],[102,13,126,13],[103,8,127,8,"isAuthenticated"],[103,23,127,23],[103,25,127,25],[103,26,127,26],[103,27,127,27,"token"],[103,32,127,32],[104,8,128,8,"isLoading"],[104,17,128,17],[105,8,129,8,"isAdmin"],[105,15,129,15],[106,8,130,8,"token"],[106,13,130,13],[107,8,131,8,"phone"],[107,13,131,13],[108,8,132,8,"retailer"],[108,16,132,16],[109,8,133,8,"login"],[109,13,133,13],[110,8,134,8,"logout"],[110,14,134,14],[111,8,135,8,"setRetailer"],[112,6,136,6],[112,7,136,8],[113,6,136,8,"children"],[113,14,136,8],[113,16,138,7,"children"],[114,4,138,15],[115,6,138,15,"fileName"],[115,14,138,15],[115,16,138,15,"_jsxFileName"],[115,28,138,15],[116,6,138,15,"lineNumber"],[116,16,138,15],[117,6,138,15,"columnNumber"],[117,18,138,15],[118,4,138,15],[118,11,139,26],[118,12,139,27],[119,2,141,0],[120,2,141,1,"_s"],[120,4,141,1],[120,5,41,16,"AuthProvider"],[120,17,41,28],[121,4,41,28],[121,12,46,17,"useRouter"],[121,23,46,26],[121,24,46,26,"useRouter"],[121,33,46,26],[122,2,46,26],[123,2,46,26,"_c"],[123,4,46,26],[123,7,41,16,"AuthProvider"],[123,19,41,28],[124,2,143,7],[124,11,143,16,"useAuth"],[124,18,143,23,"useAuth"],[124,19,143,23],[124,21,143,26],[125,4,143,26,"_s2"],[125,7,143,26],[126,4,144,2],[126,10,144,8,"context"],[126,17,144,15],[126,20,144,18],[126,24,144,18,"useContext"],[126,30,144,28],[126,31,144,28,"useContext"],[126,41,144,28],[126,43,144,29,"AuthContext"],[126,54,144,40],[126,55,144,41],[127,4,145,2],[127,8,145,6,"context"],[127,15,145,13],[127,20,145,18,"undefined"],[127,29,145,27],[127,31,145,29],[128,6,146,4],[128,12,146,10],[128,16,146,14,"Error"],[128,21,146,19],[128,22,146,20],[128,67,146,65],[128,68,146,66],[129,4,147,2],[130,4,148,2],[130,11,148,9,"context"],[130,18,148,16],[131,2,149,0],[132,2,149,1,"_s2"],[132,5,149,1],[132,6,143,16,"useAuth"],[132,13,143,23],[133,2,143,23],[133,6,143,23,"_c"],[133,8,143,23],[134,2,143,23,"$RefreshReg$"],[134,14,143,23],[134,15,143,23,"_c"],[134,17,143,23],[135,0,143,23],[135,3]],"functionMap":{"names":["<global>","AuthProvider","useEffect$argument_0","loadStoredAuth","login","logout","setRetailer","useAuth"],"mappings":"AAA;OCwC;YCS;GDE;yBEE;GF+B;gBGE;GHqB;iBIE;GJQ;sBKE;GLE;CDmB;OOE;CPM"},"hasCjsExports":false},"type":"js/module"}]}